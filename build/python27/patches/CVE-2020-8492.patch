Fixes CVE-2020-8492.
Desc:
  Python 2.7 through 2.7.17, 3.5 through 3.5.9, 3.6 through 3.6.10, 3.7 through
  3.7.6, and 3.8 through 3.8.1 allows an HTTP server to conduct Regular
  Expression Denial of Service (ReDoS) attacks against a client because of
  urllib.request.AbstractBasicAuthHandler catastrophic backtracking.

Upstream bug: https://bugs.python.org/issue39503

Upstream commit (partially backported from Python 3.7):
https://github.com/python/cpython/commit/b57a73694e26e8b2391731b5ee0b1be59437388e

--- Python-2.7.17/Lib/urllib2.py
+++ Python-2.7.17/Lib/urllib2.py
@@ -856,8 +856,15 @@ class AbstractBasicAuthHandler:
 
     # allow for double- and single-quoted realm values
     # (single quotes are a violation of the RFC, but appear in the wild)
-    rx = re.compile('(?:.*,)*[ \t]*([^ \t]+)[ \t]+'
-                    'realm=(["\']?)([^"\']*)\\2', re.I)
+    rx = re.compile('(?:^|,)'   # start of the string or ','
+                    '[ \t]*'    # optional whitespaces
+                    '([^ \t]+)' # scheme like "Basic"
+                    '[ \t]+'    # mandatory whitespaces
+                    # realm=xxx
+                    # realm='xxx'
+                    # realm="xxx"
+                    'realm=(["\']?)([^"\']*)\\2',
+                    re.I)
 
     # XXX could pre-emptively send auth info already accepted (RFC 2617,
     # end of section 2, and section 1.2 immediately after "credentials"
